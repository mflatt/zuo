#lang zuo

(require "harness.zuo")

(alert "module paths")

(check (module-path? 'zuo))
(check (module-path? 'zuo/main))
(check (module-path? 'zuo/private/main))
(check (module-path? '/zuo) #f)
(check (module-path? 'zuo/) #f)
(check (module-path? 'zuo//main) #f)
(check (module-path? 'zuo?) #f)
(check (module-path? 'zuo/?/x) #f)

(check (module-path? "main.zuo"))
(check (module-path? "private/main.zuo"))
(check (module-path? "private/../main.zuo"))
(check (module-path? "./../main.zuo"))
(check (module-path? "main"))
(check (module-path? "main.rkt"))
(check (module-path? " main.zuo "))
(check (module-path? "") #f)
(check (module-path? "a\x00b") #f)

(check (module-path? 1) #f)
(check (module-path? '(zuo)) #f)

(check (module-path-join 'zuo "list.zuo") 'zuo/list)
(check (module-path-join 'zuo/main "list.zuo") 'zuo/list)
(check (module-path-join 'zuo/private/main "list.zuo") 'zuo/private/list)
(check (module-path-join 'zuo "helper/list.zuo") 'zuo/helper/list)
(check (module-path-join 'zuo/main "helper/list.zuo") 'zuo/helper/list)
(check (module-path-join 'zuo/private/main "helper/list.zuo") 'zuo/private/helper/list)
(check (module-path-join 'zuo/private/main "../list.zuo") 'zuo/list)
(check (module-path-join 'zuo/private/main "./list.zuo") 'zuo/private/list)
(check (module-path-join 'zuo/private/main "./././../././list.zuo") 'zuo/list)
(check-fail (module-path-join 'zuo "list") "lacks \".zuo\"")
(check-fail (module-path-join 'zuo "../list.zuo") "too many up elements")
(check-fail (module-path-join 'zuo "x//list.zuo") "not a relative module library path")
(check-fail (module-path-join 'zuo "..//list.zuo") "not a relative module library path")
(check-fail (module-path-join 'zuo "list@.zuo") "not a relative module library path")
(check-fail (module-path-join 'zuo "@/list.zuo") "not a relative module library path")
(check-fail (module-path-join 'zuo "list.rkt") "not a relative module library path")
(check-fail (module-path-join 'zuo "x.y/list.zuo") "not a relative module library path")

(check (module-path-join "lib/zuo/main.zuo" "list.zuo") "lib/zuo/list.zuo")
(check (module-path-join "lib/zuo/main.zuo" "../list.zuo") "lib/list.zuo")
(check (module-path-join "lib.zuo" "list.zuo") "list.zuo")
(check-fail (module-path-join "lib/zuo/main.zuo" "list") "lacks \".zuo\"")
(check-fail (module-path-join "lib/zuo/main.zuo" "x//list.zuo") "not a relative module library path")
(check-fail (module-path-join "lib/zuo/main.zuo" "..//list.zuo") "not a relative module library path")
(check-fail (module-path-join "lib/zuo/main.zuo" "list@.zuo") "not a relative module library path")
(check-fail (module-path-join "lib/zuo/main.zuo" "@/list.zuo") "not a relative module library path")
(check-fail (module-path-join "lib/zuo/main.zuo" "list.rkt") "not a relative module library path")
(check-fail (module-path-join "lib/zuo/main.zuo" "x.y/list.zuo") "not a relative module library path")

(check-fail (module-path-join "" "x.zuo") "not a module path")
(check-fail (module-path-join 1 "x.zuo") "not a module path")
(check-fail (module-path-join "main.zuo" 1) "not a module path")
(check-fail (module-path-join 'zuo 1) "not a module path")

(check (hash? (module->hash 'zuo)))
(check-fail (module->hash 8) "not a module path")
